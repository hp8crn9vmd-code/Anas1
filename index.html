
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anas Alhaj — Principal Engineer</title>
    <meta name="theme-color" content="#000000">
    <link rel="manifest" href="manifest.json">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <style>
        :root { --bg: #050505; --text: #e0e0e0; --dim: #555; --accent: #00f260; --warn: #f2c000; --danger: #ff0055; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background: var(--bg); color: var(--text); font-family: -apple-system, BlinkMacSystemFont, monospace; overflow-x: hidden; }

        /* Canvas Layer */
        #webgl { position: fixed; inset: 0; z-index: -1; opacity: 0; transition: opacity 1s; }

        /* PERFORMANCE HUD (The Professional Indicator) */
        .debug-hud {
            position: fixed; top: 20px; right: 20px; width: 220px;
            background: rgba(0,0,0,0.85); border: 1px solid #333;
            padding: 15px; font-family: 'Courier New', monospace; font-size: 10px;
            color: #ccc; z-index: 1000; backdrop-filter: blur(5px);
            display: flex; flex-direction: column; gap: 8px;
            pointer-events: none; /* Click through */
        }
        .hud-row { display: flex; justify-content: space-between; border-bottom: 1px solid #222; padding-bottom: 2px; }
        .hud-val { color: var(--accent); font-weight: bold; }
        .hud-val.warn { color: var(--warn); }
        .hud-val.crit { color: var(--danger); }

        /* Main UI */
        nav { position: fixed; top: 0; left: 0; padding: 30px; z-index: 10; font-weight: bold; letter-spacing: 2px; }
        
        header { height: 100vh; padding: 0 5%; display: flex; flex-direction: column; justify-content: center; max-width: 1400px; margin: 0 auto; }
        .role { color: var(--dim); letter-spacing: 4px; font-size: 0.7rem; margin-bottom: 20px; }
        h1 { font-size: clamp(3rem, 10vw, 8rem); line-height: 0.9; text-transform: uppercase; margin-bottom: 40px; }
        
        /* Layout Optimization */
        #work { content-visibility: auto; contain-intrinsic-size: 1000px; padding: 100px 5%; max-width: 1400px; margin: 0 auto; }
        .row { display: flex; justify-content: space-between; padding: 30px 0; border-bottom: 1px solid #222; text-decoration: none; color: inherit; transition: 0.2s; align-items: center; }
        .row:hover { padding-left: 20px; border-color: #666; background: rgba(255,255,255,0.03); }
        .row h2 { font-size: 1.5rem; text-transform: uppercase; font-weight: 400; }

        footer { padding: 60px 5%; color: var(--dim); border-top: 1px solid #222; font-size: 0.8rem; }
    </style>

    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>

    <canvas id="webgl"></canvas>

    <div class="debug-hud">
        <div class="hud-row"><span>ENGINE</span><span class="hud-val">ANAS.RENDERER</span></div>
        <div class="hud-row"><span>FPS</span><span class="hud-val" id="hud-fps">--</span></div>
        <div class="hud-row"><span>GPU TIER</span><span class="hud-val" id="hud-tier">DETECTING...</span></div>
        <div class="hud-row"><span>RES SCALE</span><span class="hud-val" id="hud-res">1.0x</span></div>
        <div class="hud-row"><span>MEMORY</span><span class="hud-val" id="hud-mem">--</span></div>
        <div class="hud-row"><span>STATUS</span><span class="hud-val" id="hud-status">INIT</span></div>
    </div>

    <nav>ANAS ALHAJ</nav>

    <header>
        <div class="role">PRINCIPAL ENGINEER</div>
        <h1>HARDWARE<br>AWARE<br>SYSTEMS</h1>
    </header>

    <section id="work">
        <div style="border-bottom: 1px solid #fff; margin-bottom: 40px; padding-bottom: 10px;"><h2>MODULES</h2></div>
        <a href="canvas/index.html" class="row"><span>01</span><h2>Chaos Engine</h2><span>JS</span></a>
        <a href="threejs/index.html" class="row"><span>02</span><h2>Spatial Web</h2><span>3D</span></a>
        <a href="matterjs/index.html" class="row"><span>03</span><h2>Dynamics</h2><span>PHY</span></a>
        <a href="pixijs/index.html" class="row"><span>04</span><h2>Stress Test</h2><span>GPU</span></a>
        <a href="webgl/index.html" class="row"><span>05</span><h2>Shader Core</h2><span>GLSL</span></a>
    </section>

    <footer>
        SYSTEM: ONLINE • LATENCY: < 16ms
    </footer>

    <script>
        // --- ENGINEERING CORE: DYNAMIC RESOLUTION SCALING (DRS) ---
        
        const System = {
            config: {
                targetFPS: 60,
                minRes: 0.5,
                maxRes: 2.0, // Retina
                checkInterval: 1000 // Check performance every second
            },
            state: {
                fps: 60,
                currentRes: 1.0,
                frameCount: 0,
                lastTime: performance.now(),
                isLowPower: false
            },
            refs: {
                fps: document.getElementById('hud-fps'),
                res: document.getElementById('hud-res'),
                mem: document.getElementById('hud-mem'),
                tier: document.getElementById('hud-tier'),
                status: document.getElementById('hud-status')
            }
        };

        // 1. Hardware Detection
        async function detectHardware() {
            // Battery Check
            if (navigator.getBattery) {
                const battery = await navigator.getBattery();
                if (battery.saveMode || battery.level < 0.2) {
                    System.state.isLowPower = true;
                    System.config.maxRes = 1.0; // Cap resolution on low battery
                    System.refs.status.innerText = "ECONOMY MODE";
                    System.refs.status.className = "hud-val warn";
                }
            }

            // GPU Tier Estimation (Simple heuristic)
            const gl = document.createElement('canvas').getContext('webgl');
            const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
            const renderer = debugInfo ? gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) : 'Unknown';
            
            if (renderer.includes('NVIDIA') || renderer.includes('Radeon')) {
                System.refs.tier.innerText = "HIGH PERF (DEDICATED)";
            } else if (renderer.includes('Intel') || renderer.includes('Apple')) {
                System.refs.tier.innerText = "INTEGRATED";
                System.config.maxRes = 1.5; // Cap for integrated
            } else {
                System.refs.tier.innerText = "MOBILE / GENERIC";
                System.config.maxRes = 1.0;
            }
        }

        // 2. The Engine
        const init = () => {
            if (typeof THREE === 'undefined') { setTimeout(init, 50); return; }
            
            detectHardware();

            const canvas = document.getElementById('webgl');
            const renderer = new THREE.WebGLRenderer({ 
                canvas, alpha: true, antialias: false, // Antialias OFF for pure performance
                powerPreference: "high-performance" 
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(System.state.currentRes);

            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            camera.position.z = 25;

            // Geometry: Tech Cloud
            const geo = new THREE.BufferGeometry();
            const count = 1500;
            const pos = new Float32Array(count*3);
            for(let i=0; i<count*3; i++) pos[i] = (Math.random()-0.5)*60;
            geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
            const mat = new THREE.PointsMaterial({ size: 0.08, color: 0x666666, transparent: true, opacity: 0.6 });
            const mesh = new THREE.Points(geo, mat);
            scene.add(mesh);

            // Passive Inputs
            let mx=0, my=0;
            window.addEventListener('mousemove', e => { mx=(e.clientX/innerWidth-0.5)*2; my=(e.clientY/innerHeight-0.5)*2; }, {passive:true});

            // 3. Render Loop with DRS Logic
            const animate = () => {
                requestAnimationFrame(animate);

                // Logic
                mesh.rotation.y += 0.001;
                mesh.rotation.x += (my*0.3 - mesh.rotation.x)*0.05;
                mesh.rotation.y += (mx*0.3 - mesh.rotation.y)*0.05;

                renderer.render(scene, camera);

                // Performance Monitoring
                System.state.frameCount++;
                const now = performance.now();
                if (now - System.state.lastTime >= 1000) {
                    System.state.fps = System.state.frameCount;
                    System.refs.fps.innerText = System.state.fps;
                    
                    // --- THE DRS ALGORITHM ---
                    // If FPS drops below 45, lower resolution
                    if (System.state.fps < 45 && System.state.currentRes > System.config.minRes) {
                        System.state.currentRes -= 0.1;
                        renderer.setPixelRatio(System.state.currentRes);
                        System.refs.res.className = "hud-val warn";
                    } 
                    // If FPS is stable 60, try increasing resolution (up to limit)
                    else if (System.state.fps >= 58 && System.state.currentRes < System.config.maxRes) {
                        System.state.currentRes += 0.1;
                        renderer.setPixelRatio(System.state.currentRes);
                        System.refs.res.className = "hud-val";
                    }
                    
                    System.refs.res.innerText = System.state.currentRes.toFixed(1) + "x";

                    // Memory Monitor (Chrome only)
                    if (performance.memory) {
                        const used = Math.round(performance.memory.usedJSHeapSize / 1024 / 1024);
                        System.refs.mem.innerText = used + " MB";
                    }

                    System.state.frameCount = 0;
                    System.state.lastTime = now;
                }
            };
            
            canvas.style.opacity = 1;
            animate();
            
            // Efficient Resize
            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    camera.aspect = window.innerWidth/window.innerHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(window.innerWidth, window.innerHeight);
                }, 100);
            }, {passive:true});
        };

        // Smart Load
        if ('requestIdleCallback' in window) requestIdleCallback(() => setTimeout(init, 100));
        else window.addEventListener('load', init);

    </script>
</body>
</html>
